<!-- ------------------------------------------------------------------------------------------------------------
     ---------------------------------- INICIO retroalimentacion_alumno .HTML -----------------------------------
     ------------------------------------------------------------------------------------------------------------ -->

{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Retroalimentaciones</title>
<link rel="icon" type="image/png" href="{% static 'assets/imagenes/logo1.png' %}">
<link rel="stylesheet" href="{% static 'assets/css/retroalimentacion_alumno.css' %}">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
  <!-- TITULO BARRA LATERAL -->

     <nav class="sidebar">
        <div class="profile text-center p-3">
          {% if foto %}
            <img src="data:image/jpeg;base64,{{ foto }}" alt="Perfil">
          {% else %}
            <img src="https://i.pinimg.com/736x/f6/d5/b4/f6d5b458bf7aa0276c81a666c916de18.jpg" alt="Perfil">
          {% endif %}
          <h5 class="text-white">{{ nombre }} {{ apellido }}</h5>
        </div>
        <ul class="nav flex-column">
          <li><a href="{% url 'inicio_alumno' %}" class="nav-link {% if request.resolver_match.url_name == 'inicio_alumno' %}active{% endif %}"><i class="fas fa-home me-2"></i>Inicio</a></li>
          <li><a href="{% url 'perfil_alumno' %}" class="nav-link {% if request.resolver_match.url_name == 'perfil_alumno' %}active{% endif %}"><i class="fas fa-user me-2"></i>Perfil</a></li>
          <li><a href="{% url 'test_interest_alumno' %}" class="nav-link {% if request.resolver_match.url_name == 'test_interest_alumno' %}active{% endif %}"><i class="fas fa-list-check me-2"></i>Test de Interés</a></li>
          <li><a href="{% url 'informe_alumno' %}" class="nav-link {% if request.resolver_match.url_name == 'informe_alumno' %}active{% endif %}"><i class="fas fa-file-alt me-2"></i>Informes</a></li>
          <li><a href="{% url 'estadisticas_asignatura_alumno' %}" class="nav-link {% if request.resolver_match.url_name == 'estadisticas_asignatura_alumno' %}active{% endif %}"><i class="fas fa-chart-bar me-2"></i>Estadísticas Asignatura</a></li>
          <li><a href="{% url 'retroalimentacion_alumno' %}" class="nav-link {% if request.resolver_match.url_name == 'retroalimentacion_alumno' %}active{% endif %}"><i class="fas fa-file-alt me-2"></i>Mis Retroalimentaciones</a></li>
          <li>
            <a href="#" id="btnCerrarSesion" class="nav-link text-white">
              <i class="fas fa-right-to-bracket me-2"></i>Salir
            </a>
          </li>
        </ul>
      </nav>

  <!-- TITULO FORMULARIO  -->
      <div class="content">
        <div class="topbar">
          <h4>Mis Retroalimentaciones</h4>
        </div>
          <p>En esta sección puedes solicitar retroalimentación académica a tus docentes. 
            Revisa las respuestas recibidas y haz seguimiento a tus solicitudes. 
            Esta herramienta te ayuda a mejorar tu desempeño a través del acompañamiento docente.</p>

          <button id="btnSolicitud" class="btn btn-primary mt-4">
            Pedir retroalimentación
          </button>
      </div>

      <!-- Tabla de solicitudes y respuestas -->
      <div class="table-container mt-4">
        <h5>Historial de retroalimentaciones</h5>
        <button id="tabPendientes" class="btn btn-outline-morado active me-2">Pendientes</button>
        <button id="tabFinalizadas" class="btn btn-outline-morado">Finalizadas</button>
        
        <div id="retroList" class="retro-list"></div> 
      </div>
    </div>

      <!-- solicitud retros  -->
      <div id="modalSolicitud" class="custom-modal">
        <div class="modal-content p-3">
          <h5>Enviar solicitud de retroalimentación</h5>
          <input type="text" id="buscarDocente" placeholder="Buscar docente..." class="form-control mb-2">
          <ul id="suggestions-list"></ul>
          <select id="subjectSelect" class="form-select mb-2" value="">Seleccione un área</select>
          <select id="asignaturaSelect" class="form-select mb-2" value="">Selecciona Asignatura</select>
          <select id="siglaSelect" class="form-select mb-2" value="">Seleccione sigla</select>
          <textarea id="mensaje" class="form-control mb-3" rows="3" placeholder="Escribe tu mensaje..."></textarea>
          <div class="text-end">
            <button class="btn btn-secondary" id="cancelarModal">Cancelar</button>
            <button class="btn btn-success" id="enviarSolicitud">Enviar</button>
          </div>
        </div>
      </div>


<!--cerrar sesion -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const btnCerrarSesion = document.getElementById("btnCerrarSesion");

  btnCerrarSesion.addEventListener("click", (e) => {
    e.preventDefault(); // evita la redirección inmediata

    Swal.fire({
      title: "¿Deseas cerrar sesión?",
      text: "Si cierras sesión, deberás volver a iniciar sesión para continuar.",
      icon: "warning",
      showCancelButton: true,
      confirmButtonText: "Sí, cerrar sesión",
      cancelButtonText: "Cancelar",
      confirmButtonColor: "#d43939",
      cancelButtonColor: "#d1b0e9",
      reverseButtons: true,
      allowOutsideClick: false
    }).then((result) => {
      if (result.isConfirmed) {
        // Redirige solo si confirma
        window.location.href = "{% url 'Inicio' %}";
      }
    });
  });
});
</script>

      <!--llamado al js de test_interes_alumno-->
      <script src="{% static 'assets/js/retroalimentacion_alumno.js' %}"></script>

      <!--mensajes emergentes-->
    {% if messages %}
      {% for message in messages %}
      <script>
          Swal.fire({
              icon: "{% if message.tags == 'error' %}error{% elif message.tags == 'success' %}success{% elif message.tags == 'warning' %}warning{% else %}info{% endif %}",
              title: "{{ message|escapejs }}",
              confirmButtonText: "Aceptar",
              confirmButtonColor: "#d1b0e9",
              timer: 4000,
              timerProgressBar: true
          });
      </script>
      {% endfor %}
    {% endif %}

</body>
</html>

<!-- ------------------------------------------------------------------------------------------------------------
     ---------------------------------- FIN retroalimentacion_alumno .HTML --------------------------------------
     ------------------------------------------------------------------------------------------------------------ -->