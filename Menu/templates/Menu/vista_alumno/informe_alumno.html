<!-- ------------------------------------------------------------------------------------------------------------
     ------------------------------------- INICIO informe_alumno .HTML ------------------------------------------
     ------------------------------------------------------------------------------------------------------------ -->

{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Informes</title>
<link rel="icon" type="image/png" href="{% static 'assets/imagenes/logo1.png' %}">
  <!--arreglar el css de este apartado-->
<link rel="stylesheet" href="{% static 'assets/css/informe_alumno.css' %}">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<!-- TITULO BODY -->
<body>

  <!-- TITULO BARRA LATERAL -->

      <!--clase de la barra lateral-->
      <nav class="sidebar">
        <div class="profile text-center p-3">
          {% if foto %}
            <img src="data:image/jpeg;base64,{{ foto }}" alt="Perfil">
          {% else %}
            <img src="https://i.pinimg.com/736x/f6/d5/b4/f6d5b458bf7aa0276c81a666c916de18.jpg" alt="Perfil">
          {% endif %}
          <h5 class="text-white">{{ nombre }} {{ apellido }}</h5>
        </div>
        <ul class="nav flex-column">
          <li><a href="{% url 'inicio_alumno' %}" class="nav-link {% if request.resolver_match.url_name == 'inicio_alumno' %}active{% endif %}"><i class="fas fa-home me-2"></i>Inicio</a></li>
          <li><a href="{% url 'perfil_alumno' %}" class="nav-link {% if request.resolver_match.url_name == 'perfil_alumno' %}active{% endif %}"><i class="fas fa-user me-2"></i>Perfil</a></li>
          <li><a href="{% url 'test_interest_alumno' %}" class="nav-link {% if request.resolver_match.url_name == 'test_interest_alumno' %}active{% endif %}"><i class="fas fa-list-check me-2"></i>Test de Inter√©s</a></li>
          <li><a href="{% url 'informe_alumno' %}" class="nav-link {% if request.resolver_match.url_name == 'informe_alumno' %}active{% endif %}"><i class="fas fa-file-alt me-2"></i>Informes</a></li>
          <li><a href="{% url 'estadisticas_asignatura_alumno' %}" class="nav-link {% if request.resolver_match.url_name == 'estadisticas_asignatura_alumno' %}active{% endif %}"><i class="fas fa-chart-bar me-2"></i>Estad√≠sticas Asignatura</a></li>
          <li><a href="{% url 'Inicio' %}" class="nav-link text-white"><i class="fas fa-right-to-bracket me-2"></i>Salir</a></li>
        </ul>
      </nav>      

  <!-- TITULO DE INFORMES -->   
   
      <!--apartado de informes-->
      <div class="content">
        <div class="topbar">
        <h4>Informes Generados</h4>
        </div>
          <p>Aqu√≠ podr√°s ver todos tus informes guardados para poder visualizarlos y descargarlos</p>
          <ul class="list-group mt-3">
            <li class="list-group-item d-flex justify-content-between align-items-center">
              Informe 1
              <div>
                <button class="btn btn-sm btn-view-custom me-1">Ver</button>
                <button class="btn btn-sm btn-primary-custom">Descargar</button>
              </div>
            </li>
            <li class="list-group-item d-flex justify-content-between align-items-center">
              Informe 2
              <div>
                <button class="btn btn-sm btn-view-custom me-1">Ver</button>
                <button class="btn btn-sm btn-primary-custom">Descargar</button>
              </div>
            </li>
          </ul>
      </div>

      <!--ESTE ES LA ETAPA 2-->
      <div class="content">
        <div class="topbar">
          <h4>üîç  An√°lisis de IA </h4>
          <button id="btnPruebaIAFree" class="btn btn-secondary">Ejecutar IA</button>
          <button id="btnGuardarPDF" class="btn btn-success mt-3" disabled>Guardar Informe como PDF</button>
          <pre id="outputIAFree"></pre>
          <div id="iaResult" class="ia-result-container mt-4"></div>
        </div>
      </div>
 
      <!--ESTE ES LA ETAPA 2-->
      <script>
        document.getElementById("btnPruebaIAFree").addEventListener("click", async () => {
          const btn = document.getElementById("btnPruebaIAFree");
          const out = document.getElementById("outputIAFree");
          btn.disabled = true;
          btn.innerText = "Generando an√°lisis...";

          try {
            const res = await fetch("{% url 'analizar_perfil_ia_free' %}", { method: "POST", headers: { "X-CSRFToken": "{{ csrf_token }}" } });
            const data = await res.json();
            if (data.success) {
              out.textContent = JSON.stringify(data.analisis, null, 2);
              document.getElementById("btnGuardarPDF").disabled = false;
            } else {
              out.textContent = "üî¥ Error: " + (data.error || "desconocido");
            }
          } catch (err) {
            out.textContent = "üî¥ Error de conexi√≥n: " + err.message;
          } finally {
            btn.disabled = false;
            btn.innerText = "Ejecutar IA";
          }
        });
      </script>

      <!--llamado al js de informe_alumno-->
      <script src="{% static 'assets/js/informe_alumno.js' %}"></script>

      <!--mensajes emergentes-->
    {% if messages %}
      {% for message in messages %}
      <script>
          Swal.fire({
              icon: "{% if message.tags == 'error' %}error{% elif message.tags == 'success' %}success{% elif message.tags == 'warning' %}warning{% else %}info{% endif %}",
              title: "{{ message|escapejs }}",
              confirmButtonText: "Aceptar",
              confirmButtonColor: "#3085d6",
              timer: 4000,
              timerProgressBar: true
          });
      </script>
      {% endfor %}
    {% endif %}

</body>
</html>

<!-- ------------------------------------------------------------------------------------------------------------
     ------------------------------------- FIN informe_alumno .HTML ---------------------------------------------
     ------------------------------------------------------------------------------------------------------------ -->
